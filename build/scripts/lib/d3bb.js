var d3bb=function(a){return a}({},jQuery,_,Backbone,d3),d3bb=function(a,$,_,Backbone,d3){return a.ChartBaseView=Backbone.View.extend({defaults:{margin:{left:50,right:70,bottom:30,top:20},xAttr:"x",yAttr:"y",chartContainer:"#chart",templateText:{}},constructor:function(){Backbone.View.prototype.constructor.apply(this,arguments),this.listenTo(this,"show",this.afterRender),this.listenTo(this.collection,"add",this.updateChart),this.listenTo(this.collection,"remove",this.updateChart),this.listenTo(this.collection,"reset",this.updateChart)},initialize:function(a){this.config=_.extend({},this.defaults,a)},events:{load:"appendChart"},serializeData:function(){},getXScale:function(){},getYScale:function(){},renderAxes:function(){},renderData:function(){},updateChart:function(){},getScales:function(){this.scales={x:this.getXScale(),y:this.getYScale()}},render:function(){var a=_.template($(this.config.template).html());return this.$el.append(a(this.config.templateText)),this.onRender&&this.onRender(),this.trigger("show"),this},afterRender:function(){var a=this.config.margin;this.width=this.$el.width()-a.left-a.right,this.height=this.$el.height()-a.top-a.bottom,this.svg=d3.select(this.config.chartContainer).append("svg").attr("width",this.width+a.left+a.right).attr("height",this.height+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),this.getScales(),this.renderAxes(),this.renderChart()}}),a}(d3bb,jQuery,_,Backbone,d3),d3bb=function(a,$,_,Backbone,d3){return a.ChartBarView=a.ChartBaseView.extend({defaults:_.defaults({barPadding:.1},a.ChartBaseView.prototype.defaults),initialize:function(a){this.config=_.extend({},this.defaults,a)},getXScale:function(){var a=this.config.barPadding;return d3.scale.ordinal().rangeRoundBands([0,this.width],a).domain(this.collection.pluck(this.config.xAttr))},getYScale:function(){return d3.scale.linear().rangeRound([this.height,0]).domain([0,d3.max(this.collection.pluck(this.config.yAttr))])},renderAxes:function(){this.xAxis=d3.svg.axis().scale(this.scales.x).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.scales.y).orient("left"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").call(this.yAxis)},renderChart:function(){var a=this,b=this.scales.x,c=this.scales.y;this.svg.selectAll(".bar").data(this.collection.toJSON()).enter().append("rect").attr("class","bar").attr("id",function(b){return"bar-"+b[a.config.xAttr]}).attr("data-x",function(b){return b[a.config.xAttr]}).attr("data-y",function(b){return b[a.config.yAttr]}).attr("x",function(c){return b(c[a.config.xAttr])}).attr("y",function(b){return c(b[a.config.yAttr])}).attr("width",b.rangeBand()).attr("height",function(b){return a.height-c(b[a.config.yAttr])})},updateChart:function(){var a=this,b=this.scales.x,c=this.scales.y,d=this.collection.toJSON();b.domain(a.collection.pluck(a.config.xAttr)),c.domain([0,d3.max(a.collection.pluck(a.config.yAttr))]).nice();var e=this.svg.selectAll(".bar").data(d);e.exit().remove(),e.enter().append("rect").attr("class","bar").attr("id",function(b){return"bar-"+b[a.config.xAttr]}).attr("data-x",function(b){return b[a.config.xAttr]}).attr("data-y",function(b){return b[a.config.yAttr]}),a.svg.select(".x.axis").transition().duration(1e3).call(a.xAxis),a.svg.select(".y.axis").transition().duration(1e3).call(a.yAxis),e.transition().duration(1e3).attr("x",function(c){return b(c[a.config.xAttr])}).attr("y",function(b){return c(b[a.config.yAttr])}).attr("width",b.rangeBand()).attr("height",function(b){return a.height-c(b[a.config.yAttr])})}}),a}(d3bb,jQuery,_,Backbone,d3),d3bb=function(a,$,_,Backbone,d3){return a.ChartLineView=a.ChartBaseView.extend({defaults:_.defaults({yAttr:["y"],addPoints:!0,pointR:4,colors:d3.scale.category10()},a.ChartBaseView.prototype.defaults),initialize:function(a){this.config=_.extend({},this.defaults,a),Array.isArray(this.config.yAttr)||(this.config.yAttr=[this.config.yAttr])},getXScale:function(){var a=this;return d3.scale.linear().range([0,this.width]).domain(d3.extent(a.collection.toJSON(),function(b){return b[a.config.xAttr]})).nice()},getYScale:function(){var a=this,b=this.config.collection.toJSON(),c=this.config.yAttr,d=0;return _.each(c,function(a){var c=_.max(b,function(b){return b[a]})[a];d=c>d?c:d}),d3.scale.linear().range([a.height,0]).domain([0,d]).nice()},renderAxes:function(){this.xAxis=d3.svg.axis().scale(this.scales.x).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.scales.y).orient("left"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").call(this.yAxis)},renderChart:function(){var a=this,b=this.scales.x,c=this.scales.y,d=this.config.xAttr,e=this.config.yAttr,f=this.collection.toJSON();a.lines={},_.each(e,function(e,g){a.lines[e]=d3.svg.line().x(function(a){return b(a[d])}).y(function(a){return c(a[e])}),a.svg.append("svg:path").attr("class","line line-"+e).attr("id","line-"+e).attr("stroke",a.config.colors(g)).attr("d",a.lines[e](f)),a.config.addPoints&&a.svg.selectAll(".point-"+e).data(f).enter().append("circle").attr("class","point point-"+e).attr("id",function(a,b){return"line-"+e+"-point-"+b}).attr("data-x",function(a){return a[d]}).attr("data-y",function(a){return a[e]}).attr("fill",a.config.colors(g)).attr("cx",function(a){return b(a[d])}).attr("cy",function(a){return c(a[e])}).attr("r",a.config.pointR)})},updateChart:function(){var a=this,b=this.scales.x,c=this.scales.y,d=this.config.xAttr,e=this.config.yAttr,f=0,g=a.collection.toJSON();_.each(e,function(a){var b=_.max(g,function(b){return b[a]})[a];f=b>f?b:f}),b.domain(d3.extent(g,function(b){return b[a.config.xAttr]})).nice(),c.domain([0,f]).nice(),a.svg.select(".x.axis").transition().duration(1e3).call(a.xAxis),a.svg.select(".y.axis").transition().duration(1e3).call(a.yAxis),_.each(e,function(e){if(a.svg.select(".line-"+e).transition().duration(1e3).attr("class","line").attr("d",a.lines[e](g)),a.config.addPoints){var f=a.svg.selectAll(".point-"+e).data(g);f.exit().remove(),f.enter().append("circle").attr("class","point").attr("id",function(a,b){return"line-"+e+"-point-"+b}).attr("data-x",function(a){return a[d]}).attr("data-y",function(a){return a[e]}),f.transition().duration(1e3).attr("cx",function(a){return b(a[d])}).attr("cy",function(a){return c(a[e])}).attr("r",a.config.pointR)}})}}),a}(d3bb,jQuery,_,Backbone,d3),d3bb=function(a,$,_,Backbone,d3){return a.ChartPieView=a.ChartBaseView.extend({defaults:_.defaults({labels:"labels",colors:d3.scale.category20(),innerRadius:0},a.ChartBaseView.prototype.defaults),initialize:function(a){this.config=_.extend({},this.defaults,a)},renderChart:function(){var a=this,b=this.config.colors,c=Math.min(this.height,this.width)/2,d=this.config.innerRadius;a.arc=d3.svg.arc().innerRadius(d).outerRadius(c),a.pie=d3.layout.pie().value(function(b){return b[a.config.yAttr]}).sort(function(b){return b[a.config.labels]});var e=a.svg.selectAll("g.arc").data(a.pie(a.collection.toJSON())).enter().append("g").attr("class","arc").attr("transform","translate("+c+","+c+")");e.append("path").attr("fill",function(a,c){return b(c)}).attr("d",a.arc).each(function(a){this._current=a}),e.append("text").attr("transform",function(b){return"translate("+a.arc.centroid(b)+")"}).attr("text-anchor","middle").text(function(a){return a.value}).attr("class","data-label")},updateChart:function(){var a=this,b=this.config.colors,c=this.height/2,d=a.svg.selectAll("g.arc").data(a.pie(a.collection.toJSON()));d.exit().remove(),d.enter().append("g").attr("class","arc").attr("transform","translate("+c+","+c+")"),d.append("path").transition().duration(1e3).attr("fill",function(a,c){return b(c)}).attr("d",a.arc),d.append("text").attr("transform",function(b){return"translate("+a.arc.centroid(b)+")"}).attr("text-anchor","middle").text(function(a){return a.value}).attr("class","data-label")}}),a}(d3bb,jQuery,_,Backbone,d3),d3bb=function(a,$,_,Backbone,d3){return a.ChartScatterplotView=a.ChartBaseView.extend({defaults:_.defaults({r:3},a.ChartBaseView.prototype.defaults),initialize:function(a){this.config=_.extend({},this.defaults,a)},getXScale:function(){return d3.scale.linear().rangeRound([0,this.width]).domain([0,d3.max(this.collection.pluck(this.config.xAttr))]).nice()},getYScale:function(){return d3.scale.linear().rangeRound([this.height,0]).domain([0,d3.max(this.collection.pluck(this.config.yAttr))]).nice()},renderAxes:function(){this.xAxis=d3.svg.axis().scale(this.scales.x).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.scales.y).orient("left"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").call(this.yAxis)},renderChart:function(){var a=this,b=this.scales.x,c=this.scales.y;this.svg.selectAll(".point").data(this.collection.toJSON()).enter().append("circle").attr("class","point").attr("data-x",function(b){return b[a.config.xAttr]}).attr("data-y",function(b){return b[a.config.yAttr]}).attr("cx",function(c){return b(c[a.config.xAttr])}).attr("cy",function(b){return c(b[a.config.yAttr])}).attr("r",a.config.r)},updateChart:function(){var a=this,b=this.scales.x,c=this.scales.y,d=this.collection.toJSON();b.domain([0,d3.max(this.collection.pluck(this.config.xAttr))]).nice(),c.domain([0,d3.max(this.collection.pluck(this.config.yAttr))]).nice(),a.svg.select(".x.axis").transition().duration(1e3).call(a.xAxis),a.svg.select(".y.axis").transition().duration(1e3).call(a.yAxis);var e=this.svg.selectAll(".point").data(d);e.exit().remove(),e.enter().append("circle").attr("class","point").attr("data-x",function(b){return b[a.config.xAttr]}).attr("data-y",function(b){return b[a.config.yAttr]}),e.transition().duration(1e3).attr("cx",function(c){return b(c[a.config.xAttr])}).attr("cy",function(b){return c(b[a.config.yAttr])}).attr("r",a.config.r)}}),a}(d3bb,jQuery,_,Backbone,d3),d3bb=function(a,$,_,Backbone,d3){return a.ChartVbarView=a.ChartBaseView.extend({"default":_.defaults({barPadding:.1},a.ChartBaseView.prototype.defaults),initialize:function(a){this.config=_.extend({},this.defaults,a)},getXScale:function(){return d3.scale.linear().rangeRound([0,this.width]).domain([0,d3.max(this.collection.pluck(this.config.xAttr))])},getYScale:function(){var a=this.config.barPadding;return d3.scale.ordinal().rangeRoundBands([0,this.height],a).domain(this.collection.pluck(this.config.yAttr))},renderAxes:function(){this.xAxis=d3.svg.axis().scale(this.scales.x).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.scales.y).orient("left"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").call(this.yAxis)},updateChart:function(){var a=this,b=this.scales.x,c=this.scales.y,d=this.collection.toJSON();b.domain([0,d3.max(a.collection.pluck(a.config.xAttr))]).nice(),c.domain(a.collection.pluck(a.config.yAttr));var e=this.svg.selectAll(".bar").data(d);e.exit().remove(),e.enter().append("rect").attr("class","bar").attr("id",function(b){return"bar-"+b[a.config.xAttr]}).attr("data-x",function(b){return b[a.config.xAttr]}).attr("data-y",function(b){return b[a.config.yAttr]}),a.svg.select(".x.axis").transition().duration(1e3).call(a.xAxis),a.svg.select(".y.axis").transition().duration(1e3).call(a.yAxis),e.transition().duration(1e3).attr("x",0).attr("y",function(b){return c(b[a.config.yAttr])}).attr("height",c.rangeBand()).attr("width",function(c){return b(c[a.config.xAttr])})},renderChart:function(){this.scales.x,this.scales.y;this.svg.selectAll(".bar").data(this.collection.toJSON()).enter().append("rect").attr("class","bar"),this.updateChart()}}),a}(d3bb,jQuery,_,Backbone,d3);